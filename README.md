# Moskvartaly Monitor

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä –Ω–∞ —Å–∞–π—Ç–µ –º–æ—Å–∫–≤–∞—Ä—Ç–∞–ª—ã.—Ä—Ñ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram.

## –§—É–Ω–∫—Ü–∏–∏

- üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–≤–∞—Ä—Ç–∏—Ä —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä
- üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 1-3 –º–∏–Ω—É—Ç—ã (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- üíö Heartbeat-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (00:00, 06:00, 12:00, 18:00)
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏, —Ä–æ—Ç–∞—Ü–∏—è User-Agent)
- üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ SQLite
- üê≥ –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –≤ Docker/Coolify

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –õ–æ–≥–∏–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ë–æ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É** —Å –≤–∞—à–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –Ω–∞ —Å–∞–π—Ç–µ –º–æ—Å–∫–≤–∞—Ä—Ç–∞–ª—ã.—Ä—Ñ
2. **–ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–∫–∞–∑–∞—Ç—å N –∫–≤–∞—Ä—Ç–∏—Ä"** —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫
3. **–°—á–∏—Ç–∞–µ—Ç –∫–Ω–æ–ø–∫–∏** –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–≤–∞—Ä—Ç–∏—Ä:
   - `"–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ"` ‚Äî –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∑–∞–Ω—è—Ç–∞ (–Ω–µ–ª—å–∑—è –∫–ª–∏–∫–Ω—É—Ç—å)
   - `"–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"` ‚Äî –∫–≤–∞—Ä—Ç–∏—Ä–∞ **–î–û–°–¢–£–ü–ù–ê** (–º–æ–∂–Ω–æ –∫–ª–∏–∫–Ω—É—Ç—å –∏ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å)
4. **–ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–∞—Å—å —Ö–æ—Ç—å –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram üéâ

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è |
|---------|-------------------|
| üöÄ –ó–∞–ø—É—Å–∫ | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ |
| üéâ –°–≤–æ–±–æ–¥–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ | –ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" |
| üíö Heartbeat | –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (00:00, 06:00, 12:00, 18:00) |
| ‚ö†Ô∏è –û—à–∏–±–∫–∞ | –ü—Ä–∏ —Å–±–æ–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ |

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞

1. –ù–∞–ø–∏—à–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID

1. –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ–º—É –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates`
3. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id":` ‚Äî —ç—Ç–æ –≤–∞—à Chat ID

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd moskvartaly-monitor

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
# TELEGRAM_BOT_TOKEN=your_token
# TELEGRAM_CHAT_ID=your_chat_id
```

### 4. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ Playwright
npx playwright install chromium

# –¢–µ—Å—Ç —Å–∫—Ä–µ–π–ø–µ—Ä–∞ (–±–µ–∑ Telegram)
npm run test:scraper

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
npm run build
npm start
```

### 5. Docker

```bash
# –°–±–æ—Ä–∫–∞
npm run build
docker-compose build

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –õ–æ–≥–∏
docker-compose logs -f
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | ‚Äî |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | ‚Äî |
| `CHECK_INTERVAL_MINUTES` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–∏–Ω—É—Ç—ã) | 2 |
| `RANDOM_DELAY_MIN_SECONDS` | –ú–∏–Ω. —Å–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ | 0 |
| `RANDOM_DELAY_MAX_SECONDS` | –ú–∞–∫—Å. —Å–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ | 60 |
| `USE_PROXY` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ | false |
| `PROXY_URL` | URL –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞ | ‚Äî |
| `HEADLESS` | –†–µ–∂–∏–º –±–µ–∑ GUI | true |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | info |

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–∏—Å–∫–∞

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `src/config/search-profiles.ts`:

```typescript
export const searchProfiles: SearchProfile[] = [
  {
    id: 'my-search',
    name: '–ú–æ–π –ø–æ–∏—Å–∫',
    url: 'https://–º–æ—Å–∫–≤–∞—Ä—Ç–∞–ª—ã.—Ä—Ñ/kvartiry/?...',
    enabled: true,
    notifyOnNew: true,
    notifyOnAvailable: true,
    notifyOnPriceChange: false,
  },
];
```

## –î–µ–ø–ª–æ–π –≤ Coolify

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å "Docker Compose"
2. –£–∫–∞–∂–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `TELEGRAM_BOT_TOKEN`
   - `TELEGRAM_CHAT_ID`
4. –î–µ–ø–ª–æ–π!

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ index.ts           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ logger.ts          # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ scraper/           # –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞
‚îú‚îÄ‚îÄ database/          # SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îú‚îÄ‚îÄ notifier/          # Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ scheduler/         # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îî‚îÄ‚îÄ types/             # TypeScript —Ç–∏–ø—ã
```

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –°–ø–æ—Å–æ–± 1: –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ª–æ–≥–∞–º–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
npm run dev
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
INFO: Navigating to https://...           # –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
INFO: Found "–ü–æ–∫–∞–∑–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä" button     # –ù–∞—à—ë–ª –∫–Ω–æ–ø–∫—É
INFO: –ü–æ–∫–∞–∑–∞—Ç—å 39 –∫–≤–∞—Ä—Ç–∏—Ä                 # –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (39 –∫–≤–∞—Ä—Ç–∏—Ä!)
INFO: Found booking buttons via getByText # –ò—â–µ—Ç –∫–Ω–æ–ø–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
INFO: availableCount: 0, bookedCount: 39  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 —Å–≤–æ–±–æ–¥–Ω—ã—Ö, 39 –∑–∞–Ω—è—Ç—ã—Ö
INFO: All apartments still booked         # –í—Å–µ –µ—â—ë –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã
```

### –°–ø–æ—Å–æ–± 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≥–¥–µ –ï–°–¢–¨ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã
npx ts-node src/test-scraper.ts --test-available
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
```
availableCount: 1012   # –ú–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö!
bookedCount: 0
üéâ FOUND AVAILABLE APARTMENTS!
```

### –°–ø–æ—Å–æ–± 3: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

–ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –≤ –ø–∞–ø–∫—É `data/`:
- `debug-1-loaded.png` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- `debug-2-after-show.png` ‚Äî –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä"
- `debug-3-final.png` ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤–∏–¥ —Å–ø–∏—Å–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ –∏—Ö –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏.

### –°–ø–æ—Å–æ–± 4: –¢–µ—Å—Ç Telegram

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
npx ts-node src/test-telegram.ts
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–≤–∞—Ä—Ç–∏—Ä –∑–∞–ø—É—â–µ–Ω" –≤ Telegram.

### –°–ø–æ—Å–æ–± 5: Heartbeat –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è "üíö –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ" –≤:
- 00:00
- 06:00  
- 12:00
- 18:00

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—à–ª–æ ‚Äî –∑–Ω–∞—á–∏—Ç –±–æ—Ç —É–ø–∞–ª.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ** ‚Äî —Å–µ–π—á–∞—Å 39, –∑–∞–≤—Ç—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å 40 –∏–ª–∏ 35
2. **–ë–æ—Ç –∏—â–µ—Ç –∏–º–µ–Ω–Ω–æ –∫–Ω–æ–ø–∫—É "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"** ‚Äî –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ç–º–µ–Ω–∏—Ç –±—Ä–æ–Ω—å, –∫–Ω–æ–ø–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ" –Ω–∞ "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 1-3 –º–∏–Ω—É—Ç—ã** ‚Äî —Å —Ä–∞–Ω–¥–æ–º–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏
4. **–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—Å—ë** ‚Äî –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
